<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Brett Kurzurl</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; }
    #history { margin-top: 20px; }
    .entry { border-bottom: 1px solid #ccc; padding: 10px 0; }
    .copyBtn { margin-left: 10px; }
  </style>
</head>
<body>
  <h2>üîó Brett kurzurl- Generator</h2>
  <input type="text" id="longUrl" placeholder="Lange URL eingeben" size="50"><br>
  <input type="text" id="customAlias" placeholder="Optionaler Alias (z.‚ÄØB. meinlink123)" size="30"><br>
  <button onclick="shortenUrl()">K√ºrzen</button>
  <button onclick="clearHistory()">Verlauf l√∂schen</button>
  <p id="result"></p>
  <div id="qrcode"></div>

  <h3>Verlauf:</h3>
  <div id="history"></div>

  <script>
    const historyEl = document.getElementById("history");

    function loadHistory() {
      const data = JSON.parse(localStorage.getItem("shortLinks") || "[]");
      historyEl.innerHTML = "";
      data.forEach((item, index) => addToHistory(item.original, item.short, index));
    }

    function addToHistory(original, short, index) {
      const entry = document.createElement("div");
      entry.className = "entry";
      entry.innerHTML = `
        Original: <a href="${original}" target="_blank">${original}</a><br>
        Kurz: <a href="${short}" target="_blank">${short}</a>
        <button class="copyBtn" onclick="copyToClipboard('${short}')">üìã</button>
        <button onclick="deleteEntry(${index})">üóëÔ∏è</button>
      `;
      historyEl.prepend(entry);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      alert("Kurz-URL kopiert!");
    }

    function deleteEntry(index) {
      const data = JSON.parse(localStorage.getItem("shortLinks") || "[]");
      data.splice(index, 1);
      localStorage.setItem("shortLinks", JSON.stringify(data));
      loadHistory();
    }

    function clearHistory() {
      if (confirm("M√∂chtest du wirklich den gesamten Verlauf l√∂schen?")) {
        localStorage.removeItem("shortLinks");
        historyEl.innerHTML = "";
      }
    }

    async function shortenUrl() {
      const longUrl = document.getElementById("longUrl").value;
      const customAlias = document.getElementById("customAlias").value;
      const result = document.getElementById("result");
      const qrContainer = document.getElementById("qrcode");
      qrContainer.innerHTML = "";

      if (!longUrl) {
        result.textContent = "Bitte gib eine URL ein.";
        return;
      }

      try {
        const requestBody = {
          url: longUrl,
          domain: "tinyurl.com"
        };
        if (customAlias) requestBody.alias = customAlias;

        const response = await fetch("https://api.tinyurl.com/create", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "" 
          },
          body: JSON.stringify(requestBody)
        });

        const data = await response.json();
        if (data.data && data.data.tiny_url) {
          const shortUrl = data.data.tiny_url;
          result.innerHTML = `Kurz-URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
          new QRCode(qrContainer, { text: shortUrl, width: 200, height: 200 });

          const history = JSON.parse(localStorage.getItem("shortLinks") || "[]");
          history.push({ original: longUrl, short: shortUrl });
          localStorage.setItem("shortLinks", JSON.stringify(history));
          loadHistory();
        } else {
          const message = data.errors?.[0]?.message || "Alias m√∂glicherweise vergeben.";
          result.textContent = "Fehler: " + message;
        }
      } catch (error) {
        result.textContent = `Netzwerkfehler: ${error.message}`;
      }
    }

    loadHistory();
  </script>
</body>
</html>

